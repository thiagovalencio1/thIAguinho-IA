<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThIAguinho J.A.R.V.I.S.</title>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a, #2b2c39);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .jarvis-card {
            background: rgba(0, 0, 0, 0.7);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 140, 255, 0.5);
            margin: 20px 0;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 30px rgba(0, 140, 255, 0.5); }
            50% { box-shadow: 0 0 60px rgba(0, 140, 255, 0.2); }
        }
        h1 {
            color: #008cff;
            text-align: center;
            margin-bottom: 5px;
        }
        h2 {
            color: #008cff;
            margin-top: 25px;
        }
        button {
            background: #008cff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin: 10px 0;
            transition: background 0.3s;
        }
        button:hover {
            background: #006bb3;
        }
        input, select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #008cff;
            background: rgba(0, 0, 0, 0.3);
            color: white;
        }
        .tab {
            overflow: hidden;
            border: 1px solid #008cff;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
            width: 25%;
            border-radius: 0;
        }
        .tab button:hover {
            background-color: #006bb3;
        }
        .tab button.active {
            background-color: #008cff;
        }
        .tabcontent {
            display: none;
            padding: 20px;
            border-top: none;
        }
        .status {
            color: #4CAF50;
            font-weight: bold;
            font-size: 1.2em;
        }
        .error {
            color: #f44336;
        }
        .bluetooth-status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ThIAguinho J.A.R.V.I.S.</h1>
        <p style="text-align: center;">Seu assistente automotivo inteligente</p>

        <!-- Abas principais -->
        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'vehicle')">Veículo</button>
            <button class="tablinks" onclick="openTab(event, 'bluetooth')">Bluetooth</button>
            <button class="tablinks" onclick="openTab(event, 'maintenance')">Manutenção</button>
            <button class="tablinks" onclick="openTab(event, 'consumption')">Consumo</button>
            <button class="tablinks" onclick="openTab(event, 'assistant')">Assistente</button>
        </div>

        <!-- Aba Bluetooth -->
        <div id="bluetooth" class="tabcontent">
            <div class="jarvis-card">
                <h2>Conexão Bluetooth</h2>
                <button onclick="connectToELM327()">Conectar ao ELM327</button>
                <div class="bluetooth-status" id="bluetooth-status">Aguardando conexão...</div>
            </div>
        </div>

        <!-- Restante das abas (veículo, manutenção, consumo, assistente) -->
        <!-- ... [código das outras abas permanece igual] ... -->
    </div>

    <script>
        // Variáveis globais do Bluetooth
        let bluetoothDevice;
        let bluetoothCharacteristic;
        let isConnected = false;

        // Função para conectar ao ELM327
        async function connectToELM327() {
            try {
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    filters: [{ 
                        name: 'CHX',
                        services: ['00001101-0000-1000-8000-00805f9b34fb']
                    }]
                });
                
                const server = await bluetoothDevice.gatt.connect();
                const service = await server.getPrimaryService('00001101-0000-1000-8000-00805f9b34fb');
                bluetoothCharacteristic = await service.getCharacteristic('00001101-0000-1000-8000-00805f9b34fb');
                
                // Envia comandos de inicialização (como o Torque Pro)
                await sendBluetoothCommand('ATZ'); // Reinicia o ELM327
                await sendBluetoothCommand('ATE0'); // Desativa eco
                await sendBluetoothCommand('ATSP0'); // Protocolo automático
                
                isConnected = true;
                document.getElementById('bluetooth-status').textContent = 'Conectado ao ELM327!';
                document.getElementById('bluetooth-status').classList.add('status');
                
                // Inicia leitura contínua de dados
                startReadingVehicleData();
            } catch (error) {
                document.getElementById('bluetooth-status').textContent = 'Erro: ' + error.message;
                document.getElementById('bluetooth-status').classList.add('error');
            }
        }

        // Função para enviar comandos ao ELM327
        async function sendBluetoothCommand(cmd) {
            if (!isConnected) return;
            const encoder = new TextEncoder();
            await bluetoothCharacteristic.writeValue(encoder.encode(cmd + '\r'));
            await new Promise(resolve => setTimeout(resolve, 100));
            const value = await bluetoothCharacteristic.readValue();
            return new TextDecoder().decode(value.buffer);
        }

        // Função para ler dados do veículo
        async function startReadingVehicleData() {
            if (!isConnected) return;
            
            try {
                // Lê RPM (010C)
                const rpmResponse = await sendBluetoothCommand('010C');
                const rpm = parseRPM(rpmResponse);
                document.getElementById('rpm').textContent = rpm;
                
                // Lê velocidade (010D)
                const speedResponse = await sendBluetoothCommand('010D');
                const speed = parseSpeed(speedResponse);
                document.getElementById('speed').textContent = speed;
                
                // Lê temperatura (0105)
                const tempResponse = await sendBluetoothCommand('0105');
                const temp = parseTemperature(tempResponse);
                document.getElementById('temperature').textContent = temp;
                
                // Lê DTCs (03)
                const dtcResponse = await sendBluetoothCommand('03');
                const dtc = parseDTC(dtcResponse);
                document.getElementById('dtc').textContent = dtc || 'Nenhum';
                
                // Atualiza a cada 2 segundos
                setTimeout(startReadingVehicleData, 2000);
            } catch (error) {
                document.getElementById('bluetooth-status').textContent = 'Erro na comunicação: ' + error.message;
                document.getElementById('bluetooth-status').classList.add('error');
                isConnected = false;
            }
        }

        // Funções para parsear respostas
        function parseRPM(response) {
            const hex = response.split(' ').slice(2).join('');
            return (parseInt(hex, 16) / 4).toFixed(0);
        }

        function parseSpeed(response) {
            const hex = response.split(' ').slice(2).join('');
            return parseInt(hex, 16);
        }

        function parseTemperature(response) {
            const hex = response.split(' ').slice(2).join('');
            return (parseInt(hex, 16) - 40).toFixed(0);
        }

        function parseDTC(response) {
            const codes = response.match(/4300[0-9A-F]{4}/g);
            return codes ? codes.map(code => 'P' + code.slice(4)).join(', ') : null;
        }

        // Restante do código (veículo, manutenção, consumo, assistente) permanece igual
    </script>
</body>
</html>